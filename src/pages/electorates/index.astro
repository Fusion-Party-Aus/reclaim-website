---
export const prerender = false
import BaseLayout from '../../layouts/BaseLayout.astro'
import Header from '../../components/Header.astro'
import Hero from '../../components/Hero.astro'
import Footer from '../../components/Footer.astro'
import { Icon } from 'astro-icon/components'
import { getElectorates, getElectoratesPage, urlFor } from '../../lib/sanity'
import '../../styles/global.css'

const electorates = await getElectorates()
const pageData = await getElectoratesPage()

const title = pageData?.title || 'Electorates'
const subtitle = pageData?.subtitle || "Where we're taking back what they stole"
const introCard = pageData?.introCard || {
  title: 'Target Seats',
  body: "We're starting where the neglect has been the worst: growth corridors and outer suburbs that were promised infrastructure and delivered excuses.",
  highlight:
    "Each electorate page shows our candidate, local commitments, and exactly how we'll fund and deliver them.",
}
const ctaSection = pageData?.ctaSection || {
  title: 'Not in these electorates?',
  body: "We're building campaigns across Victoria. Help us bring real change to your area.",
}

const cardAccents = ['#C926F2', '#5EFFD8', '#FFED00']
---

<BaseLayout
  title={`${title} | Future Party Victoria`}
  description="Where we're running, what we stand for, and how we'll fix decades of neglect in outer suburbs."
>
  <Header />
  <Hero title={title} subtitle={subtitle} />

  {/* ── Intro panel — full-bleed mint ── */}
  <section
    class="border-b-8 border-black py-14 px-4 md:px-8 relative overflow-hidden"
    style="background: #5EFFD8;"
  >
    {/* Ghost watermark */}
    <div class="absolute inset-0 flex items-center justify-end pointer-events-none overflow-hidden">
      <span
        class="text-[16rem] font-black uppercase leading-none select-none text-black"
        style="font-family: 'Anton', sans-serif; opacity: 0.05; transform: translateX(10%);"
        >VIC</span
      >
    </div>
    <div class="max-w-5xl mx-auto relative z-10">
      <div
        class="inline-block bg-black text-mint px-3 py-1 text-xs font-black uppercase tracking-widest mb-5 border-2 border-black"
      >
        {introCard.title}
      </div>
      <p
        class="text-xl md:text-2xl font-black uppercase leading-tight mb-5 border-l-8 border-black pl-6 text-black"
      >
        {introCard.body}
      </p>
      <p class="text-base font-black text-black/70 border-l-4 border-black pl-4 max-w-2xl">
        {introCard.highlight}
      </p>
    </div>
  </section>

  <main class="bg-white py-16 px-4 md:px-8">
    <div class="max-w-7xl mx-auto">
      {
        electorates.length === 0 ? (
          /* Empty state */
          <div
            class="border-4 border-black bg-yellow p-10 text-center"
            style="box-shadow: 8px 8px 0 0 #000;"
          >
            <Icon name="mdi:alert" class="w-16 h-16 mx-auto mb-4 text-black" />
            <p class="text-xl font-black uppercase mb-6">
              We're finalising our candidates for upcoming elections. Check back soon!
            </p>
            <a
              href="/past-candidates"
              class="inline-flex items-center gap-2 px-6 py-3 font-black uppercase text-sm border-4 border-black bg-black text-white hover:-translate-y-0.5 transition-all"
              style="box-shadow: 4px 4px 0 0 #C926F2; font-family: 'Archivo Black', sans-serif;"
            >
              <Icon name="mdi:archive" class="w-5 h-5" />
              View Past Candidates
            </a>
          </div>
        ) : (
          <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {electorates.map((electorate, index) => {
              const accent = cardAccents[index % cardAccents.length]
              const accentIsLight = accent === '#5EFFD8' || accent === '#FFED00'
              return (
                <article
                  id={electorate.slug.current}
                  class="border-4 border-black bg-white flex flex-col hover:-translate-y-0.5 transition-transform"
                  style={`box-shadow: 6px 6px 0 0 ${accent};`}
                >
                  {/* Candidate image */}
                  {electorate.candidateImage ? (
                    <div class="border-b-4 border-black overflow-hidden relative">
                      <img
                        src={urlFor(electorate.candidateImage)
                          .width(600)
                          .height(360)
                          .fit('crop')
                          .url()}
                        alt={electorate.candidateName || `Candidate for ${electorate.name}`}
                        class="w-full h-48 object-cover grayscale hover:grayscale-0 transition-all duration-300"
                      />
                      {/* Accent corner triangle */}
                      <div
                        class="absolute bottom-0 right-0 w-12 h-12"
                        style={`background: ${accent}; clip-path: polygon(100% 0, 100% 100%, 0 100%);`}
                      />
                    </div>
                  ) : (
                    /* No image: colour stripe */
                    <div class="h-2 w-full" style={`background: ${accent};`} />
                  )}

                  <div class="p-6 flex flex-col flex-1">
                    {/* Electorate label */}
                    <div
                      class="inline-flex items-center gap-1 border-2 border-black text-xs font-black uppercase tracking-widest px-3 py-1 mb-3 w-fit"
                      style={`background: ${accent}; color: ${accentIsLight ? '#000' : '#fff'};`}
                    >
                      <Icon name="mdi:flag" class="w-3 h-3" />
                      Electorate
                    </div>

                    <h2
                      class="text-2xl md:text-3xl font-black uppercase mb-1 leading-tight text-black"
                      style="font-family: 'Archivo Black', sans-serif;"
                    >
                      {electorate.name}
                    </h2>

                    {electorate.subtitle && (
                      <p class="text-xs font-black uppercase tracking-wide text-black/60 mb-3">
                        {electorate.subtitle}
                      </p>
                    )}

                    {electorate.candidateName && (
                      <div
                        class="flex items-center gap-2 border-2 border-black bg-black text-white px-3 py-2 w-fit mb-4"
                        style={`box-shadow: 2px 2px 0 0 ${accent};`}
                      >
                        <Icon name="mdi:account" class="w-4 h-4" style={`color: ${accent};`} />
                        <span class="font-black text-xs uppercase">{electorate.candidateName}</span>
                      </div>
                    )}

                    {/* Commitments preview */}
                    {Array.isArray(electorate.commitments) && electorate.commitments.length > 0 && (
                      <ul class="space-y-2 mb-5 flex-1">
                        {electorate.commitments.slice(0, 3).map((commitment) => (
                          <li
                            class="flex items-start gap-2 border-l-4 pl-3 py-1"
                            style={`border-color: ${accent};`}
                          >
                            <span class="text-xl shrink-0">{commitment.icon}</span>
                            <div>
                              <div class="font-black text-xs uppercase leading-tight">
                                {commitment.title}
                              </div>
                              <div class="text-xs font-semibold text-gray-500 mt-0.5">
                                {commitment.highlight}
                              </div>
                            </div>
                          </li>
                        ))}
                      </ul>
                    )}

                    {/* CTA button */}
                    <a
                      href={`/electorates/${electorate.slug.current}`}
                      class="mt-auto inline-flex items-center justify-center gap-2 px-4 py-3 font-black uppercase text-sm border-4 border-black bg-black text-white hover:bg-magenta hover:border-magenta transition-all"
                      style={`box-shadow: 3px 3px 0 0 ${accent}; font-family: 'Archivo Black', sans-serif;`}
                    >
                      <Icon name="mdi:eye" class="w-4 h-4" />
                      View Plan for {electorate.name}
                    </a>
                  </div>
                </article>
              )
            })}
          </section>
        )
      }

      {/* ── CTA ── */}
      <section
        class="mt-16 bg-black text-white border-4 border-black relative overflow-hidden"
        style="box-shadow: 8px 8px 0 0 #5EFFD8;"
      >
        <div
          class="absolute bottom-0 right-0 w-40 h-40 bg-yellow"
          style="clip-path: polygon(100% 0, 100% 100%, 0 100%);"
        >
        </div>
        <div class="px-8 py-12 relative z-10">
          <div
            class="inline-block bg-magenta text-white px-3 py-1 text-xs font-black uppercase tracking-widest mb-4 border-2 border-white"
          >
            Build the Movement
          </div>
          <h2
            class="text-3xl md:text-4xl font-black uppercase mb-3 leading-tight"
            style="font-family: 'Archivo Black', sans-serif;"
          >
            {ctaSection.title}
          </h2>
          <p class="text-base font-black text-white/65 mb-8 border-l-4 border-yellow pl-4 max-w-lg">
            {ctaSection.body}
          </p>
          <div class="flex flex-wrap gap-3">
            <a
              href="/get-involved"
              class="inline-flex items-center gap-2 px-5 py-3 font-black uppercase text-sm border-4 border-white bg-magenta text-white hover:-translate-y-0.5 transition-all"
              style="box-shadow: 3px 3px 0 0 #FFED00; font-family: 'Archivo Black', sans-serif;"
            >
              <Icon name="mdi:hand-heart" class="w-5 h-5" />
              Volunteer in Your Area
            </a>
            <a
              href="/manifesto"
              class="inline-flex items-center gap-2 px-5 py-3 font-black uppercase text-sm border-4 border-white bg-transparent text-white hover:bg-white hover:text-black transition-all"
              style="font-family: 'Archivo Black', sans-serif;"
            >
              <Icon name="mdi:book-open" class="w-5 h-5" />
              Read the Manifesto
            </a>
          </div>
        </div>
      </section>

      {/* Archive link */}
      {
        electorates.length > 0 && (
          <div class="mt-10 text-center">
            <a
              href="/past-candidates"
              class="inline-flex items-center gap-2 font-black uppercase text-xs border-b-2 border-black hover:text-magenta hover:border-magenta transition-colors pb-0.5"
            >
              <Icon name="mdi:archive-search-outline" class="w-4 h-4" />
              View Past Candidates Archive
            </a>
          </div>
        )
      }
    </div>
  </main>

  <Footer />
</BaseLayout>
