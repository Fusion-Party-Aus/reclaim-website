---
// Footer component ‚Äî Neo-Brutalist
import { Icon } from 'astro-icon/components'
import { getDocuments, getElectorates } from '../lib/sanity'

interface SocialLink {
  platform: string
  icon: string
  url: string
  ariaLabel?: string
}

interface ResourceLink {
  label: string
  url: string
}

interface Footer {
  logo: { mainText: string; subText: string }
  socialLinks: SocialLink[]
  resourceLinks: ResourceLink[]
  banner: { text: string; rotation: number }
  authorization: string
  copyrightText?: string
  networkBranding?: { text: string; url: string }
}

const footers = await getDocuments<Footer>('footer')
const electorates = await getElectorates()
const footer = footers?.[0]

const defaultFooter: Footer = {
  logo: { mainText: 'FUTURE', subText: 'PARTY' },
  socialLinks: [
    {
      platform: 'Instagram',
      icon: 'mdi:instagram',
      url: 'https://www.instagram.com/fusionpartyaus/',
      ariaLabel: 'Instagram',
    },
    {
      platform: 'Facebook',
      icon: 'mdi:facebook',
      url: 'https://www.facebook.com/FusionPartyAus/',
      ariaLabel: 'Facebook',
    },
    {
      platform: 'YouTube',
      icon: 'mdi:youtube',
      url: 'https://www.youtube.com/c/fusionpartyaus',
      ariaLabel: 'YouTube',
    },
    {
      platform: 'Bluesky',
      icon: 'mdi:cloud',
      url: 'https://bsky.app/profile/fusionparty.org.au',
      ariaLabel: 'Bluesky',
    },
    {
      platform: 'Twitter/X',
      icon: 'mdi:twitter',
      url: 'https://twitter.com/FusionPartyAus',
      ariaLabel: 'Twitter/X',
    },
    {
      platform: 'TikTok',
      icon: 'mdi:music-note',
      url: 'https://www.tiktok.com/@fusionpartyaus',
      ariaLabel: 'TikTok',
    },
    {
      platform: 'Mastodon',
      icon: 'mdi:mastodon',
      url: 'https://mastodon.au/@FusionPartyAus',
      ariaLabel: 'Mastodon',
    },
    {
      platform: 'Discord',
      icon: 'mdi:discord',
      url: 'https://www.fusionparty.org.au/discord',
      ariaLabel: 'Discord',
    },
    {
      platform: 'GitHub',
      icon: 'mdi:github',
      url: 'https://github.com/Fusion-Party-Aus',
      ariaLabel: 'GitHub',
    },
  ],
  resourceLinks: [
    { label: 'Code of Conduct', url: 'https://www.fusionparty.org.au/code_of_conduct' },
    { label: 'Constitution', url: 'https://www.fusionparty.org.au/constitution' },
    { label: 'Privacy Policy', url: 'https://www.fusionparty.org.au/privacy_policy' },
  ],
  banner: { text: 'üö´ We Accept NO Corporate Donations', rotation: 0 },
  authorization: 'Authorised by Drew Wolfendale, Fusion Party Victoria.',
}

const footerData = footer || defaultFooter
---

<footer class="bg-black text-white relative overflow-hidden">
  {/* ‚ïê‚ïê‚ïê NO CORPORATE DONATIONS ‚Äî full-bleed banner ‚ïê‚ïê‚ïê */}
  <div class="bg-magenta border-y-4 border-black py-5 px-4 relative overflow-hidden">
    {/* Ghost text behind */}
    <div
      class="absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden"
    >
      <span
        class="text-[8rem] font-black uppercase leading-none select-none text-black opacity-10"
        style="font-family: 'Anton', sans-serif;">NO DONORS</span
      >
    </div>
    <div
      class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 relative z-10"
    >
      <p
        class="text-xl md:text-2xl font-black uppercase text-white tracking-wider"
        style="font-family: 'Archivo Black', sans-serif;"
      >
        {footerData.banner.text}
      </p>
      <p class="text-sm font-black uppercase text-yellow border-l-4 border-yellow pl-4 text-left">
        Funded by members & small donors only.<br />That's why we answer to you.
      </p>
    </div>
  </div>

  {/* ‚ïê‚ïê‚ïê MAIN FOOTER BODY ‚ïê‚ïê‚ïê */}
  <div class="border-b-4 border-white/10 py-16 px-4 md:px-8">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-10 lg:gap-12">
        {/* Brand column */}
        <div class="lg:col-span-1">
          <div
            class="inline-block p-3 bg-white border-4 border-black mb-5"
            style="box-shadow: 5px 5px 0px 0px #C926F2;"
          >
            <img src="/solo-full-colour.svg" alt="Fusion Victoria" class="h-10 w-auto" />
          </div>

          <h3
            class="text-2xl font-black mb-1 leading-tight"
            style="color: #C926F2; font-family: 'Archivo Black', sans-serif;"
          >
            {footerData.logo.mainText}<br />{footerData.logo.subText}
          </h3>
          <p class="font-black text-sm uppercase mb-4 border-l-4 border-yellow pl-3 text-yellow">
            Taking Back What They Stole.
          </p>

          {/* Social links ‚Äî single horizontal row with uniform sizing */}
          <div class="flex flex-wrap gap-2 mt-4">
            {
              footerData.socialLinks.map((social, index) => {
                const accentColors = ['#5EFFD8', '#FFED00', '#C926F2']
                const accent = accentColors[index % 3]
                return (
                  <a
                    href={social.url}
                    target="_blank"
                    rel="noopener"
                    class="social-icon p-2 bg-black border-2 border-white/20 hover:border-transparent transition-all hover:-translate-y-0.5"
                    style={`hover:background: ${accent};`}
                    aria-label={social.ariaLabel || social.platform}
                    data-accent={accent}
                  >
                    <Icon name={social.icon} class="w-5 h-5 text-white" />
                  </a>
                )
              })
            }
          </div>
        </div>

        {/* Policy links */}
        <div>
          <h4
            class="text-sm font-black uppercase tracking-widest mb-5 text-black bg-mint inline-block px-3 py-1"
          >
            Policy
          </h4>
          <ul class="space-y-2">
            {
              [
                { label: 'All Policies', href: '/policies' },
                { label: 'Manifesto', href: '/manifesto' },
                { label: 'About Us', href: '/about' },
                { label: 'FAQ', href: '/faq' },
                { label: 'Contact Us', href: '/contact' },
              ].map((link) => (
                <li>
                  <a
                    href={link.href}
                    class="footer-link font-black uppercase text-sm text-gray-300 hover:text-mint transition-colors flex items-center gap-2"
                  >
                    <span class="text-mint">‚Üí</span> {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>

        {/* Electorates */}
        <div>
          <h4
            class="text-sm font-black uppercase tracking-widest mb-5 text-black bg-yellow inline-block px-3 py-1"
          >
            Candidates
          </h4>
          <ul class="space-y-2">
            <li>
              <a
                href="/electorates"
                class="footer-link font-black uppercase text-sm text-gray-300 hover:text-yellow transition-colors flex items-center gap-2"
              >
                <span class="text-yellow">‚Üí</span> All Electorates
              </a>
            </li>
            {
              electorates.slice(0, 5).map((electorate) => (
                <li>
                  <a
                    href={`/electorates/${electorate.slug.current}`}
                    class="footer-link font-black uppercase text-sm text-gray-300 hover:text-yellow transition-colors flex items-center gap-2"
                  >
                    <span class="text-yellow">‚Üí</span> {electorate.name}
                  </a>
                </li>
              ))
            }
            <li>
              <a
                href="/past-candidates"
                class="footer-link font-black uppercase text-sm text-gray-300 hover:text-yellow transition-colors flex items-center gap-2"
              >
                <span class="text-yellow">‚Üí</span> Past Candidates
              </a>
            </li>
          </ul>
        </div>

        {/* Governance */}
        <div>
          <h4
            class="text-sm font-black uppercase tracking-widest mb-5 text-black bg-white/80 inline-block px-3 py-1"
          >
            Governance
          </h4>
          <ul class="space-y-2">
            {
              footerData.resourceLinks.map((link) => (
                <li>
                  <a
                    href={link.url}
                    target="_blank"
                    class="footer-link font-black uppercase text-sm text-gray-300 hover:text-white transition-colors flex items-center gap-2"
                  >
                    <span class="text-white/60">‚Üí</span> {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>

        {/* Take Action */}
        <div>
          <h4
            class="text-sm font-black uppercase tracking-widest mb-5 text-black bg-magenta inline-block px-3 py-1"
          >
            Take Action
          </h4>
          <ul class="space-y-2 mb-6">
            {
              [
                {
                  label: 'Join Fusion',
                  href: 'https://www.fusionparty.org.au/join',
                  external: true,
                },
                { label: 'Volunteer', href: '/get-involved', external: false },
                { label: 'Donate', href: 'https://www.fusionparty.org.au/donate', external: true },
                {
                  label: 'Merch Store',
                  href: 'https://www.fusionparty.org.au/store',
                  external: true,
                },
              ].map((link) => (
                <li>
                  <a
                    href={link.href}
                    target={link.external ? '_blank' : undefined}
                    rel={link.external ? 'noopener' : undefined}
                    class="footer-link font-black uppercase text-sm text-gray-300 hover:text-magenta transition-colors flex items-center gap-2"
                  >
                    <span class="text-magenta">‚Üí</span> {link.label}
                  </a>
                </li>
              ))
            }
          </ul>

          {/* Donate CTA ‚Äî high-contrast button */}
          <a
            href="https://www.fusionparty.org.au/donate"
            target="_blank"
            class="inline-flex items-center gap-2 px-5 py-3 font-black uppercase text-sm border-4 border-black bg-yellow text-black hover:-translate-y-0.5 transition-all"
            style="box-shadow: 4px 4px 0px 0px #C926F2; font-family: 'Archivo Black', sans-serif;"
          >
            <Icon name="mdi:currency-usd" class="w-5 h-5" />
            Donate Now
          </a>
        </div>
      </div>
    </div>
  </div>

  {/* ‚ïê‚ïê‚ïê BOTTOM BAR ‚ïê‚ïê‚ïê */}
  <div class="px-4 md:px-8 py-6">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-3">
      <p class="text-xs font-black uppercase text-gray-500">
        ¬© {footerData.copyrightText || '2024‚Äì2025 Future Party Victoria. All rights reserved.'}
      </p>
      <p class="text-xs font-bold text-gray-600">{footerData.authorization}</p>
      <p class="text-xs text-gray-600">
        Part of{' '}
        <a
          href={footerData.networkBranding?.url || 'https://www.fusionparty.org.au'}
          target="_blank"
          class="underline hover:text-mint transition-colors"
        >
          {footerData.networkBranding?.text || 'Fusion'}
        </a>
      </p>
    </div>
  </div>

  {/* Bottom colour stripe ‚Äî mirrors hero triple stripe */}
  <div class="h-1 w-full bg-yellow"></div>
  <div class="h-0.5 w-full bg-mint"></div>
  <div class="h-px w-full bg-magenta"></div>
</footer>

<style>
  .footer-link:hover {
    padding-left: 0.15rem;
    transition:
      padding-left 0.15s ease,
      color 0.15s ease;
  }

  .social-icon:hover {
    background: var(--accent, #5effd8) !important;
  }

  .social-icon:hover svg {
    color: #000 !important;
  }
</style>

<script>
  // Social icon accent colours on hover
  document.querySelectorAll('.social-icon').forEach((el) => {
    const accent = (el as HTMLElement).dataset.accent || '#5EFFD8'
    el.addEventListener('mouseenter', () => {
      ;(el as HTMLElement).style.backgroundColor = accent
      ;(el as HTMLElement).style.borderColor = accent
      const icon = el.querySelector('svg') as SVGElement | null
      if (icon) icon.style.color = '#000'
    })
    el.addEventListener('mouseleave', () => {
      ;(el as HTMLElement).style.backgroundColor = ''
      ;(el as HTMLElement).style.borderColor = ''
      const icon = el.querySelector('svg') as SVGElement | null
      if (icon) icon.style.color = ''
    })
  })
</script>
